<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sakhi Voice</title>
<meta name="description" content="Sakhi Voice ‚Äî multilingual pseudo lip-sync with mic (single file)" />
<link rel="icon" href="./Sakhi_logo.png" />
<style>
  :root { --bg:#0b1020; --panel:#0f1733; --text:#e9eef9; --muted:#a8b5d9; --glass:rgba(255,255,255,.10); --accent:#e63946; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:radial-gradient(80% 80% at 50% 20%, #16224b 0%, var(--bg) 55%);
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  }
  .wrap{min-height:100dvh;display:flex;flex-direction:column;gap:12px;padding:14px;max-width:620px;margin:0 auto}
  .card{background:linear-gradient(160deg,rgba(255,255,255,.06),rgba(255,255,255,.02));
        border:1px solid var(--glass);border-radius:18px;padding:14px;box-shadow:0 10px 36px rgba(0,0,0,.35)}
  header{display:flex;align-items:center;gap:10px;padding-top:6px}
  header img{height:28px;width:auto;border-radius:6px}
  header h1{font-size:1.1rem;margin:0;font-weight:650;letter-spacing:.2px}
  /* Avatar panel */
  .avatar-panel{display:grid;gap:12px;grid-template-rows:1fr auto}
  .stage{position:relative;overflow:hidden;border-radius:16px;border:1px solid var(--glass);
         background:linear-gradient(180deg,#24325f 0%,#1a2142 65%,#121a34 100%);display:grid;place-items:center;min-height:260px}
  .avatar{width:min(92%,420px);aspect-ratio:9/16;border-radius:20px;position:relative;overflow:hidden;border:1px solid rgba(0,0,0,.06);
          background:linear-gradient(160deg,#ffe8f0 0%,#ffd8e8 40%,#fbd2e8 60%,#ffdfe8 100%)}
  .saree{position:absolute;bottom:-10%;left:50%;transform:translateX(-50%);width:130%;height:62%;
         background:radial-gradient(60% 40% at 50% 10%,rgba(255,255,255,.45),rgba(255,255,255,0) 60%),
         linear-gradient(100deg,#c8005a,#ff2a7f 40%,#ff5b9d 70%,#ff7fb4);
         clip-path:polygon(10% 0%,90% 0%,100% 35%,84% 100%,16% 100%,0% 35%);filter:drop-shadow(0 10px 14px rgba(200,0,60,.35))}
  .head{position:absolute;top:10%;left:50%;transform:translateX(-50%);width:62%;aspect-ratio:1/1.1;background:#f7d2c6;
        border-radius:50% 50% 42% 42%/48% 48% 52% 52%;box-shadow:0 6px 0 rgba(200,120,120,.25) inset}
  .hair{position:absolute;inset:-6% -6% 40% -6%;background:#2a1a17;border-bottom-left-radius:60% 50%;border-bottom-right-radius:60% 50%;
        box-shadow:0 14px 24px rgba(0,0,0,.35)}
  .bindi{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%);width:12px;height:12px;background:var(--accent);
         border-radius:50%;box-shadow:0 0 8px rgba(230,57,70,.4)}
  .eye{position:absolute;top:52%;width:14%;height:10px;background:#111;border-radius:10px;transform-origin:center}
  .eye.left{left:33%}.eye.right{right:33%}
  .blink{animation:blink 6s infinite}
  @keyframes blink{0%,48%,52%,100%{transform:scaleY(1)}50%{transform:scaleY(.1)}}
  .mouth{position:absolute;top:68%;left:50%;transform:translateX(-50%);width:26%;height:16px;background:#7d1b2a;
         border-radius:0 0 14px 14px/0 0 12px 12px;box-shadow:inset 0 -4px 0 rgba(0,0,0,.25);transition:height .08s,border-radius .08s}
  .mouth.open{height:34px;border-radius:0 0 18px 18px/0 0 16px 16px}
  .necklace{position:absolute;top:82%;left:50%;transform:translateX(-50%);width:48%;height:10px;border-radius:10px;
            background:radial-gradient(circle at 10% 50%,#ffd36d,#e2a900 60%,#9b6b00);box-shadow:0 4px 8px rgba(0,0,0,.25)}
  /* Controls */
  .controls{display:grid;gap:10px;grid-template-columns:1fr 1fr}
  select,textarea,button{
    background:var(--panel);color:var(--text);border:1px solid var(--glass);border-radius:12px;padding:10px 12px;font-size:.95rem
  }
  textarea{grid-column:1/-1;min-height:90px;resize:vertical}
  .row{display:flex;gap:10px}
  .primary{background:linear-gradient(90deg,#3d66ff,#7aa2ff);border:none;font-weight:700}
  .ghost{background:transparent}
  .toggle{display:flex;align-items:center;gap:8px;justify-content:center}
  .led{width:10px;height:10px;border-radius:50%;background:#555;border:1px solid #333}
  .led.live{background:#1dd75b;box-shadow:0 0 10px rgba(29,215,91,.7)}
  .muted{color:var(--muted)}
  .presets{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px}
  .preset{font-size:.8rem;padding:6px 10px;border-radius:999px;border:1px solid var(--glass);background:var(--panel);cursor:pointer}
  @media (min-width:540px){.avatar-panel{height:68vh}}
</style>
</head>
<body>
  <div class="wrap" aria-live="polite">
    <header class="card">
      <img src="./JIo_logo.png" alt="Jio logo" />
      <img src="./Sakhi_logo.png" alt="Sakhi logo" />
      <h1>Sakhi Voice ‚Äî Multilingual</h1>
    </header>

    <section class="card avatar-panel">
      <div class="stage">
        <div class="avatar" aria-label="Indian woman in saree avatar">
          <div class="head">
            <div class="hair"></div>
            <div class="bindi"></div>
            <div class="eye left blink"></div>
            <div class="eye right blink"></div>
            <div id="mouth" class="mouth"></div>
          </div>
          <div class="necklace"></div>
          <div class="saree"></div>
        </div>
      </div>

      <div class="controls">
        <select id="lang">
          <option value="en-IN" selected>English (India)</option>
          <option value="hi-IN">Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</option>
          <option value="kn-IN">Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)</option>
          <option value="mr-IN">Marathi (‡§Æ‡§∞‡§æ‡§†‡•Ä)</option>
          <option value="ta-IN">Tamil (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç)</option>
          <option value="te-IN">Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</option>
          <option value="ml-IN">Malayalam (‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç)</option>
          <option value="gu-IN">Gujarati (‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä)</option>
          <option value="bn-IN">Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</option>
          <option value="pa-IN">Punjabi (‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä)</option>
        </select>

        <select id="voice"></select>

        <textarea id="text" placeholder="Type a message for Sakhi to speak‚Ä¶">Namaste! I am HR Sakhi ‚Äî your multilingual assistant. How can I help you today?</textarea>

        <div class="row" style="grid-column:1/-1">
          <button class="primary" id="speakBtn">‚ñ∂Ô∏è Speak</button>
          <button class="ghost" id="stopBtn">‚èπ Stop</button>

          <button class="ghost toggle" id="micBtn" style="margin-left:auto;">
            üéôÔ∏è <span id="micLabel">Mic</span>
            <span id="led" class="led" aria-label="mic status"></span>
          </button>
        </div>

        <div class="presets" id="presets" style="grid-column:1/-1;"></div>
        <div class="muted" id="status" style="grid-column:1/-1;">Tip: Click üéôÔ∏è Mic and allow permission to speak to HR Sakhi.</div>
      </div>
    </section>

    <footer class="muted">¬© 2025 ‚Ä¢ Sakhi Voice ‚Ä¢ Demo only ¬∑ Uses browser speech (no server)</footer>
  </div>

<script>
  // ------------------ TTS (speechSynthesis) + pseudo lip-sync ------------------
  const synth = window.speechSynthesis;
  const langSel = document.getElementById('lang');
  const voiceSel = document.getElementById('voice');
  const textEl  = document.getElementById('text');
  const speakBtn= document.getElementById('speakBtn');
  const stopBtn = document.getElementById('stopBtn');
  const mouth   = document.getElementById('mouth');
  const presetsEl = document.getElementById('presets');
  const statusEl  = document.getElementById('status');

  let voices = [];
  let flapTimer = null;

  const SAMPLE_LINES = {
    "en-IN": "Hello! I am HR Sakhi. How can I help you today?",
    "hi-IN": "‡§®‡§Æ‡§∏‡•ç‡§§‡•á! ‡§Æ‡•à‡§Ç ‡§è‡§ö‡§Ü‡§∞ ‡§∏‡§ñ‡•Ä ‡§π‡•Ç‡§Å‡•§ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡§ø‡§∏ ‡§§‡§∞‡§π ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•Ä ‡§π‡•Ç‡§Å?",
    "kn-IN": "‡≤®‡≤Æ‡≤∏‡≥ç‡≤§‡≥Ü! ‡≤®‡≤æ‡≤®‡≥Å HR ‡≤∏‡≤ñ‡≤ø. ‡≤®‡≤ø‡≤Æ‡≤ó‡≥Ü ‡≤π‡≥á‡≤ó‡≥Ü ‡≤∏‡≤π‡≤æ‡≤Ø ‡≤Æ‡≤æ‡≤°‡≤≤‡≤ø?",
    "mr-IN": "‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞! ‡§Æ‡•Ä HR ‡§∏‡§ñ‡•Ä ‡§Ü‡§π‡•á. ‡§Æ‡•Ä ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§ï‡§∂‡•Ä ‡§Æ‡§¶‡§§ ‡§ï‡§∞‡•Ç?",
    "ta-IN": "‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç HR ‡Æö‡Æï‡Æø. ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æâ‡Æ§‡Æµ‡Æ≤‡Ææ‡ÆÆ‡Øç?",
    "te-IN": "‡∞®‡∞Æ‡∞∏‡±ç‡∞§‡±á! ‡∞®‡±á‡∞®‡±Å HR ‡∞∏‡∞ñ‡∞ø. ‡∞Æ‡±Ä‡∞ï‡±Å ‡∞é‡∞≤‡∞æ ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ö‡±á‡∞Ø‡∞ó‡∞≤‡∞®‡±Å?",
    "ml-IN": "‡¥®‡¥Æ‡¥∏‡µç‚Äå‡¥ï‡¥æ‡¥∞‡¥Ç! ‡¥û‡¥æ‡µª HR ‡¥∏‡¥ñ‡¥ø. ‡¥û‡¥æ‡µª ‡¥é‡¥ô‡µç‡¥ô‡¥®‡µÜ ‡¥∏‡¥π‡¥æ‡¥Ø‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç?",
    "gu-IN": "‡™®‡™Æ‡™∏‡´ç‡™§‡´á! ‡™π‡´Å‡™Ç HR ‡™∏‡™ñ‡´Ä ‡™õ‡´Å‡™Ç. ‡™π‡´Å‡™Ç ‡™ï‡´á‡™µ‡´Ä ‡™∞‡´Ä‡™§‡´á ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡´Ä ‡™∂‡™ï‡´Å‡™Ç?",
    "bn-IN": "‡¶®‡¶Æ‡¶∏‡ßç‡¶ï‡¶æ‡¶∞! ‡¶Ü‡¶Æ‡¶ø ‡¶è‡¶á‡¶ö‡¶Ü‡¶∞ ‡¶∏‡¶ñ‡ßÄ‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶ï‡ßÄ‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶ø?",
    "pa-IN": "‡®∏‡®§ ‡®∏‡©ç‡®∞‡©Ä ‡®Ö‡®ï‡®æ‡®≤! ‡®Æ‡©à‡®Ç ‡®ê‡®ö‡®Ü‡®∞ ‡®∏‡®ñ‡©Ä ‡®π‡®æ‡®Ç‡•§ ‡®Æ‡©à‡®Ç ‡®§‡©Å‡®π‡®æ‡®°‡©Ä ‡®ï‡®ø‡®µ‡©á‡®Ç ‡®Æ‡®¶‡®¶ ‡®ï‡®∞ ‡®∏‡®ï‡®¶‡©Ä ‡®π‡®æ‡®Ç?"
  };

  const FEMALE_HINTS = ["female","zira","sonia","priya","meera","neural","arfa","heera","ananya","raveena","susan","zira","zaira"];

  function buildPresets(){
    presetsEl.innerHTML='';
    Object.entries(SAMPLE_LINES).forEach(([k,v])=>{
      const b=document.createElement('button');
      b.className='preset'; b.textContent=k; b.title=v;
      b.onclick=()=>{ langSel.value=k; populateVoices(); textEl.value=v; };
      presetsEl.appendChild(b);
    });
  }

  function loadVoices(){
    voices = synth.getVoices();
    populateVoices();
  }

  function preferFemale(list){
    // pick first voice whose name hints at female; else first in list
    const hit = list.find(v => FEMALE_HINTS.some(h => (v.name||"").toLowerCase().includes(h)));
    return hit || list[0];
  }

  function populateVoices(){
    const lang = langSel.value.toLowerCase();
    voiceSel.innerHTML='';
    const primary = voices.filter(v => v.lang && v.lang.toLowerCase().startsWith(lang));
    const fallback= voices.filter(v => v.lang && v.lang.toLowerCase().startsWith(lang.split('-')[0]));
    const finalList = primary.length ? primary : (fallback.length ? fallback : voices);

    finalList.forEach((v,i)=>{
      const opt=document.createElement('option');
      opt.value=v.name; opt.textContent=`${v.name} ‚Äî ${v.lang}`;
      voiceSel.appendChild(opt);
    });
    // auto-select a female-ish voice if available
    if (finalList.length){
      const fav = preferFemale(finalList);
      voiceSel.value = fav.name;
    }
  }

  speechSynthesis.onvoiceschanged = loadVoices;
  if (!voices.length) setTimeout(loadVoices, 80);

  function startFlap(){ if (flapTimer) clearInterval(flapTimer); flapTimer=setInterval(()=>mouth.classList.toggle('open'), 90); }
  function stopFlap(){ if (flapTimer) clearInterval(flapTimer); mouth.classList.remove('open'); }

  function speak(text){
    const t = (text ?? textEl.value ?? "").trim(); if (!t) return;
    if (synth.speaking) synth.cancel();

    const u = new SpeechSynthesisUtterance(t);
    u.lang = langSel.value;

    const chosen = voices.find(v => v.name === voiceSel.value);
    if (chosen) u.voice = chosen;

    u.rate = 0.95; u.pitch = 1.0;

    u.onboundary = () => { mouth.classList.add('open'); setTimeout(()=>mouth.classList.remove('open'), 60); };
    u.onstart = startFlap;
    u.onend   = stopFlap;
    u.onerror = stopFlap;

    synth.speak(u);
  }

  speakBtn.addEventListener('click', ()=>speak());
  stopBtn.addEventListener('click', ()=>{ if (synth.speaking) synth.cancel(); stopFlap(); });
  langSel.addEventListener('change', ()=>{ populateVoices(); textEl.value = SAMPLE_LINES[langSel.value] || textEl.value; });

  // ------------------ Mic (SpeechRecognition) ------------------
  const led = document.getElementById('led');
  const micBtn = document.getElementById('micBtn');
  const micLabel = document.getElementById('micLabel');

  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  let rec = SR ? new SR() : null;
  let listening = false;

  if (rec){
    rec.continuous = false;
    rec.interimResults = false;
    rec.lang = 'en-IN';

    rec.onstart = ()=>{ listening = true; led.classList.add('live'); micLabel.textContent='Listening‚Ä¶'; statusEl.textContent='Listening‚Ä¶ speak now'; };
    rec.onend   = ()=>{ listening = false; led.classList.remove('live'); micLabel.textContent='Mic'; };
    rec.onerror = (e)=>{ statusEl.textContent = 'Mic error: ' + (e.error || 'Unknown'); listening=false; led.classList.remove('live'); micLabel.textContent='Mic'; };

    rec.onresult = (e)=>{
      const txt = (e.results[0] && e.results[0][0] && e.results[0][0].transcript) || '';
      statusEl.textContent = 'You said: ' + txt;
      const reply = hrReply(txt);
      // Speak back in the selected language (default en-IN)
      speak(reply);
    };
  } else {
    micBtn.disabled = true;
    statusEl.textContent = 'Mic not supported in this browser. Use Chrome on desktop/mobile.';
  }

  micBtn.addEventListener('click', ()=>{
    if (!rec) return;
    if (listening){ rec.stop(); return; }
    // keep recognition language aligned with dropdown where possible
    rec.lang = (langSel.value || 'en-IN');
    try { rec.start(); }
    catch(e){ /* some browsers throw if already started */ }
  });

  // ------------------ Simple HR reply logic ------------------
  function hrReply(q){
    const s = (q||'').toLowerCase();

    if (s.includes('leave') || s.includes('vacation') || s.includes('holiday')){
      return 'HR Sakhi: You can apply for leave in the myHR portal. For emergencies, please inform your manager and submit the request within 24 hours.';
    }
    if (s.includes('policy') || s.includes('policies')){
      return 'HR Sakhi: Our latest HR policies are in the Policy Hub. Would you like the link emailed to you?';
    }
    if (s.includes('benefit') || s.includes('insurance') || s.includes('medical')){
      return 'HR Sakhi: Core benefits include health insurance for you and dependents, accident cover, and wellness support. For plan details, open the Benefits section.';
    }
    if (s.includes('salary') || s.includes('payslip')){
      return 'HR Sakhi: Payslips are available on the Payroll page on the last business day of each month.';
    }
    if (s.includes('hello') || s.includes('hi') || s.includes('namaste')){
      return 'Hello! I am HR Sakhi. How can I help you today?';
    }
    // fallback: echo
    return 'HR Sakhi: I heard "' + q + '". I can help with leave, policies, benefits, or payroll.';
  }

  // init
  buildPresets();
  // greet once on load (optional)
  setTimeout(()=>speak('Hello! I am HR Sakhi. Tap the mic to talk to me.'), 600);
</script>
</body>
</html>
